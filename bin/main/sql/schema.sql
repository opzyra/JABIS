## DB 기본정보 셋팅
CREATE DATABASE jabis;
USE jabis;
grant all privileges on app180801.* to app180801@localhost identified by 'fdin1135';

## 계정 정보
CREATE TABLE `member` (
	`EMAIL` VARCHAR(50) NOT NULL,
	`PASSWORD` VARCHAR(200) NOT NULL,
	`PASSWORD_UPDATE` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
	`REG_DATE` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
	`DELETE_DATE` TIMESTAMP NULL DEFAULT NULL,
	`EXPIRE_DATE` TIMESTAMP NULL DEFAULT NULL,
	`ACCESS_LAST_DATE` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
	`ACCESS_TRY_COUNT` INT(11) NOT NULL DEFAULT '0',
	`ENABLED_CODE` INT(11) NOT NULL DEFAULT '0',
	`DELETE_STATUS` TINYINT(1) NOT NULL DEFAULT '0',
	`NAME` VARCHAR(200) NOT NULL,
	`PHONE` VARCHAR(200) NULL DEFAULT NULL,
	`ROLE_CODE` INT(11) NOT NULL DEFAULT '0',
	`AUTH_STR` VARCHAR(100) NULL DEFAULT NULL,
	`SUBJECT_CODE` INT(11) NOT NULL DEFAULT '0',
	`AVATAR` VARCHAR(10) NOT NULL DEFAULT '미',
	PRIMARY KEY (`EMAIL`)
)
COLLATE='utf8_general_ci'
ENGINE=InnoDB
;

# 게시판
CREATE TABLE `board` (
	`IDX` INT(11) NOT NULL AUTO_INCREMENT,
	`EMAIL` VARCHAR(50) NOT NULL,
	`CATEGORY_CODE` INT(11) NOT NULL,
	`IMPORTENT` TINYINT(1) NOT NULL DEFAULT '0',
	`TITLE` VARCHAR(100) NOT NULL DEFAULT '',
	`CONTENTS` TEXT NOT NULL,
	`WRITE_DATE` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
	`DELETE_DATE` TIMESTAMP NULL DEFAULT NULL,
	`DELETE_STATUS` TINYINT(1) NOT NULL DEFAULT '0',
	`VIEW_COUNT` INT(11) NOT NULL DEFAULT '0',
	`COMMENTS_COUNT` INT(11) NOT NULL DEFAULT '0',
	`AUTH_LEVEL` INT(11) NOT NULL DEFAULT '0',
	PRIMARY KEY (`IDX`),
	INDEX `FK_board_member` (`EMAIL`),
	CONSTRAINT `FK_board_member` FOREIGN KEY (`EMAIL`) REFERENCES `member` (`EMAIL`)
)
COLLATE='utf8_general_ci'
ENGINE=InnoDB
;




# 댓글
CREATE TABLE `comments` (
	`IDX` INT(11) NOT NULL AUTO_INCREMENT,
	`BOARD_IDX` INT(11) NOT NULL DEFAULT '0',
	`EMAIL` VARCHAR(50) NOT NULL,
	`CONTENTS` TEXT NOT NULL,
	`WRITE_DATE` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
	`DELETE_DATE` TIMESTAMP NOT NULL DEFAULT '0000-00-00 00:00:00',
	`DELETE_STATUS` TINYINT(1) NOT NULL DEFAULT '0',
	PRIMARY KEY (`IDX`),
	INDEX `FK_comments_board` (`BOARD_IDX`),
	INDEX `FK_comments_member` (`EMAIL`),
	CONSTRAINT `FK_comments_board` FOREIGN KEY (`BOARD_IDX`) REFERENCES `board` (`IDX`),
	CONSTRAINT `FK_comments_member` FOREIGN KEY (`EMAIL`) REFERENCES `member` (`EMAIL`)
)
COLLATE='utf8_general_ci'
ENGINE=InnoDB
;


# 학생 정보
CREATE TABLE `student` (
	`IDX` INT(11) NOT NULL AUTO_INCREMENT,
	`NAME` VARCHAR(200) NOT NULL,
	`STATUS` INT(11) NOT NULL DEFAULT '0',
	`GENDER` INT(11) NULL DEFAULT '0',
	`E_SCHOOL` VARCHAR(100) NULL DEFAULT NULL,
	`M_SCHOOL` VARCHAR(100) NULL DEFAULT NULL,
	`H_SCHOOL` VARCHAR(100) NULL DEFAULT NULL,
	`SCHOOL` VARCHAR(100) NULL DEFAULT NULL,
	`GRADE` INT(11) NOT NULL DEFAULT '1',
	`GRADE_CODE` INT(11) NOT NULL DEFAULT '0',
	`PHONE` VARCHAR(200) NOT NULL,
	`PARENT_PHONE` VARCHAR(200) NOT NULL,
	`ZONE_CODE` INT(5) UNSIGNED ZEROFILL NOT NULL,
	`ADDRESS_API` VARCHAR(200) NOT NULL,
	`ADDRESS_INPUT` VARCHAR(200) NOT NULL,
	`CAR` TINYINT(1) NOT NULL DEFAULT '0',
	`RECOMMEND` VARCHAR(200) NULL DEFAULT NULL,
	`REG_DATE` TIMESTAMP NULL DEFAULT NULL,
	`CLASS_NOMAL` VARCHAR(100) NULL DEFAULT NULL,
	`CLASS_TEST` VARCHAR(100) NULL DEFAULT NULL,
	`HRT_EMAIL` VARCHAR(50) NULL DEFAULT NULL,
	`WRITER_EMAIL` VARCHAR(50) NULL DEFAULT NULL,
	PRIMARY KEY (`IDX`),
	INDEX `FK_student_member` (`HRT_EMAIL`),
	INDEX `FK_student_member_2` (`WRITER_EMAIL`),
	INDEX `FK_student_class_2` (`CLASS_TEST`),
	INDEX `FK_student_class` (`CLASS_NOMAL`),
	CONSTRAINT `FK_student_class` FOREIGN KEY (`CLASS_NOMAL`) REFERENCES `class` (`NAME`) ON DELETE SET NULL,
	CONSTRAINT `FK_student_class_2` FOREIGN KEY (`CLASS_TEST`) REFERENCES `class` (`NAME`) ON DELETE SET NULL,
	CONSTRAINT `FK_student_member` FOREIGN KEY (`HRT_EMAIL`) REFERENCES `member` (`EMAIL`) ON DELETE SET NULL,
	CONSTRAINT `FK_student_member_2` FOREIGN KEY (`WRITER_EMAIL`) REFERENCES `member` (`EMAIL`) ON DELETE SET NULL
)
COLLATE='utf8_general_ci'
ENGINE=InnoDB
;


# 형제 정보
CREATE TABLE `sibling` (
	`IDX` INT(11) NOT NULL AUTO_INCREMENT,
	`STUDENT_IDX` INT(11) NOT NULL,
	`RELATION` VARCHAR(20) NOT NULL,
	`NAME` VARCHAR(20) NOT NULL,
	`SCHOOL` VARCHAR(100) NULL DEFAULT NULL,
	`GRADE` INT(11) NOT NULL DEFAULT '1',
	`GRADE_CODE` INT(11) NOT NULL DEFAULT '0',
	`MEMO` VARCHAR(500) NULL DEFAULT NULL,
	PRIMARY KEY (`IDX`),
	INDEX `FK_sibling_student` (`STUDENT_IDX`),
	CONSTRAINT `FK_sibling_student` FOREIGN KEY (`STUDENT_IDX`) REFERENCES `student` (`IDX`) ON DELETE CASCADE
)
COLLATE='utf8_general_ci'
ENGINE=InnoDB
;


# 학급
CREATE TABLE `class` (
	`NAME` VARCHAR(100) NOT NULL,
	`TYPE` INT(11) NOT NULL DEFAULT '0',
	PRIMARY KEY (`NAME`)
)
COLLATE='utf8_general_ci'
ENGINE=InnoDB
;

# 상담일지
CREATE TABLE `counse` (
	`IDX` INT(11) NOT NULL AUTO_INCREMENT,
	`STUDENT_IDX` INT(11) NOT NULL,
	`MODE` INT(11) NOT NULL DEFAULT '0',
	`COUNSE_DATE` DATE NOT NULL,
	`WRITE_DATE` DATE NOT NULL,
	`WRITE_EMAIL` VARCHAR(50) NULL DEFAULT NULL,
	`FUTURE` VARCHAR(50) NULL DEFAULT NULL,
	`STUDY_STYLE` TEXT NULL,
	`STUDENT_STYLE` TEXT NULL,
	`PARENT_STYLE` TEXT NULL,
	`PARENT_REQUEST` TEXT NULL,
	`STUDENT_COUNSE` TEXT NULL,
	`PARENT_COUNSE` TEXT NULL,
	PRIMARY KEY (`IDX`),
	UNIQUE INDEX `COUNSE_DATE` (`STUDENT_IDX`, `COUNSE_DATE`),
	INDEX `FK_counse_member` (`WRITE_EMAIL`),
	INDEX `WRITE_DATE` (`WRITE_DATE`),
	CONSTRAINT `FK_counse_member` FOREIGN KEY (`WRITE_EMAIL`) REFERENCES `member` (`EMAIL`) ON DELETE SET NULL,
	CONSTRAINT `FK_counse_student` FOREIGN KEY (`STUDENT_IDX`) REFERENCES `student` (`IDX`) ON DELETE CASCADE
)
COLLATE='utf8_general_ci'
ENGINE=InnoDB
;



# 성적
CREATE TABLE `score` (
	`IDX` INT(11) NOT NULL AUTO_INCREMENT,
	`STUDENT_IDX` INT(11) NOT NULL,
	`YEAR` INT(11) NOT NULL,
	`MODE` INT(11) NOT NULL,
	`TYPE` INT(11) NOT NULL,
	`HIGH_AVERAGE` INT(11) NOT NULL DEFAULT '0',
	PRIMARY KEY (`IDX`),
	UNIQUE INDEX `STUDENT_IDX` (`STUDENT_IDX`, `YEAR`, `MODE`, `TYPE`)
)
COLLATE='utf8_general_ci'
ENGINE=InnoDB
;

# 중등부 내신
CREATE TABLE `middle_nesin` (
	`SCORE_IDX` INT(11) NOT NULL,
	`SUBJECT_CODE` INT(11) NOT NULL,
	`SCORE` DOUBLE NOT NULL,
	`AVERAGE` DOUBLE NOT NULL,
	`DEVIATION` DOUBLE NOT NULL,
	`APPLICANTS` INT(11) NOT NULL,
	`RANKING` INT(11) NULL DEFAULT NULL,
	INDEX `FK_middle_nesin_score` (`SCORE_IDX`),
	INDEX `FK_middle_nesin_subject` (`SUBJECT_CODE`),
	CONSTRAINT `FK_middle_nesin_score` FOREIGN KEY (`SCORE_IDX`) REFERENCES `score` (`IDX`) ON DELETE CASCADE,
	CONSTRAINT `FK_middle_nesin_subject` FOREIGN KEY (`SUBJECT_CODE`) REFERENCES `subject` (`IDX`)
)
COLLATE='utf8_general_ci'
ENGINE=InnoDB
;

# 고등부 내신
CREATE TABLE `high_nesin` (
	`SCORE_IDX` INT(11) NOT NULL,
	`SUBJECT_CODE` INT(11) NOT NULL,
	`SCORE` DOUBLE NOT NULL,
	`RATING` INT(11) NOT NULL,
	`UNIT` INT(11) NOT NULL,
	INDEX `FK_high_nesin_score` (`SCORE_IDX`),
	INDEX `FK_high_nesin_subject` (`SUBJECT_CODE`),
	CONSTRAINT `FK_high_nesin_score` FOREIGN KEY (`SCORE_IDX`) REFERENCES `score` (`IDX`) ON DELETE CASCADE,
	CONSTRAINT `FK_high_nesin_subject` FOREIGN KEY (`SUBJECT_CODE`) REFERENCES `subject` (`IDX`)
)
COLLATE='utf8_general_ci'
ENGINE=InnoDB
;

# 고등부 모의고사
CREATE TABLE `high_moi` (
	`SCORE_IDX` INT(11) NOT NULL,
	`SUBJECT_CODE` INT(11) NOT NULL,
	`SCORE` DOUBLE NOT NULL,
	`RATING` INT(11) NOT NULL,
	INDEX `FK_high_moi_score` (`SCORE_IDX`),
	INDEX `FK_high_moi_subject` (`SUBJECT_CODE`),
	CONSTRAINT `FK_high_moi_score` FOREIGN KEY (`SCORE_IDX`) REFERENCES `score` (`IDX`) ON DELETE CASCADE,
	CONSTRAINT `FK_high_moi_subject` FOREIGN KEY (`SUBJECT_CODE`) REFERENCES `subject` (`IDX`)
)
COLLATE='utf8_general_ci'
ENGINE=InnoDB
;

# 교과목
CREATE TABLE `subject` (
	`IDX` INT(11) NOT NULL AUTO_INCREMENT,
	`NAME` VARCHAR(50) NOT NULL,
	`DESCRIPTION` VARCHAR(200) NOT NULL,
	`ORDER` INT(11) NOT NULL,
	PRIMARY KEY (`IDX`),
	UNIQUE INDEX `NAME` (`NAME`)
)
COLLATE='utf8_general_ci'
ENGINE=InnoDB
;

# 알림
CREATE TABLE `notification` (
	`IDX` INT(11) NOT NULL AUTO_INCREMENT,
	`EMAIL` VARCHAR(50) NOT NULL,
	`ICON` VARCHAR(100) NOT NULL,
	`TITLE` VARCHAR(300) NOT NULL,
	`REG_DATE` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
	`READ` TINYINT(1) NULL DEFAULT '0',
	`READ_DATE` TIMESTAMP NULL DEFAULT NULL,
	PRIMARY KEY (`IDX`),
	INDEX `FK_notification_member` (`EMAIL`),
	CONSTRAINT `FK_notification_member` FOREIGN KEY (`EMAIL`) REFERENCES `member` (`EMAIL`)
)
COLLATE='utf8_general_ci'
ENGINE=InnoDB
;
